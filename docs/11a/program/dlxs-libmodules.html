<html>
<head>
<title>DLXS Library Modules</title>



 </head>         <BODY>
<table class="updateTable" CELLSPACING="3" CELLPADDING="3" border="1">
<tr>
<td>Last updated</td>
<td>2003-03-06 12:47:49 EST</td>
</tr>
<tr>
<td>Doc Title</td>
<td>DLXS Library Modules</td>
</tr>
<tr>
<td>Author 1</td>
<td>Pagliere, Alan</td>
</tr>
<tr>
<td>Author 2</td>
<td>Farber, Phillip</td>
</tr>
<tr>
<td>CVS Revision</td>
<td>$Revision: 1.8 $</td>
</tr>
</table>

<DIV CLASS="pageTitle">DLXS Middleware Library Modules</div>
    
    
      <P>This document describes the DLXS Perl Library Modules used by the DLXS middleware. Unless otherwise noted, any file with a ".pm" extension is an Object Oriented Perl module. Modules are marked with the classes that use them.</P>
    
    
    <H1>Global configuration</H1>
      <P>These modules contain global configuration variables shared by all DLXS middleware.</P>
      <H2>LibGlobals.cfg</H2>
        <P>Configuration file for certain global variables shared by all DLXS modules.  <TT>LibGlobals</TT> is primarily concerned with collection database configuration.  An important variable is <TT>$gDatabaseSelector</TT> which defines the type of collection database storage (e.g., CSV, MySQL, etc.) the middleware is to use.</P>

      <H2>LibVersion.pm</H2>
        <P>
        <I>Not object oriented.</I><BR />
        Holds version information for the shared code found in files in the $DLXSROOT/lib directory. This allows other Perl modules to require specific versions of the DLXS Library modules as a group.</P>
    
    
    <H1>BookBag modules</H1>
      <P>These modules are related to the BookBag feature of the DLXS middleware.</P>
      
      <H2>BookBag.cfg</H2>
        <P>
         This file contains variable definitions for the use of the BookBag related modules.  The variables configure the SMTP host value for the mail server and the "From:" address that is to appear in the email generated by the "Mail Bookbag Contents" feature.</P>

      <H2>BookBag.pm</H2>
        <P>
The base class <TT>BookBag</TT>. This container class implements the behavior of a persistent group of records that the user chooses to save from the results of searches. In TextClass, the persistence is accomplished by saving the <TT>BookBag</TT> object within the <TT>DlpsSession</TT> object and saving that object to a persistent repository such as a file or database. Class methods include those that handle adding items to, and deleting items from, the Bookbag, emailing Bookbag items, etc.</P>

      <H2>BookBagItem.pm</H2>
        <P>
<TT>BookBagItem</TT> is a base class representing items stored in the <TT>BookBag</TT> object. The two principal methods are <TT>GetItemHeaderAsText</TT> and <TT>GetItemHeaderAsHtml</TT>.  The former generates a textual version of the record stored in the <TT>BookBagItem</TT> object for downloading. The latter generates filtered HTML for display within the BookBag window.  These filtering tasks differ depending on the application and these differences are expressed in the subclasses of <TT>BookBagItem</TT> (see following).  <B>Note</B>: ImageClass stores item IDs in the <TT>BookBag</TT> object rather than having its own <TT>BookBagItem</TT> subclass. </P>

      <H2>BookBagItem/</H2>
        <P>Directory to hold subclasses of the <TT>BookBagItem</TT> base class.</P>

      <H2>BookBagItem::BBItemBC.pm</H2>
        <P>
The subclass of <TT>BookBagItem</TT> for use with BibClass.</P>

      <H2>BookBagItem::BBItemTC.pm</H2>
        <P>
The subclass of <TT>BookBagItem</TT> for use with TextClass.</P>

    
    
    <H1>Database access and collection resolution</H1>
      <P>The <TT>CollsInfo</TT> and <TT>GroupsInfo</TT> classes in this
category provide an abstract API to the collection database.    
<TT>DbUtils</TT> is non-object-oriented and provides a thinner 
interface modeled more closely on Perl DBI.  The more abstract 
interfaces in the <TT>CollsInfo</TT> and <TT>GroupsInfo</TT> classes 
are based on the <TT>DbUtils</TT> interface.
</P>

      <P>The <TT>CollsInfo</TT> and <TT>GroupsInfo</TT> objects provide interfaces to the Collection rows and the Groups rows of the database.</P>
      <H2>DbUtils.pm</H2>
      <P><I>Not object oriented.</I><BR />
 This module groups together a number of utility subroutines used by the middleware to connect to and interact with a SQL database via the Perl DBI.</P>

      <H2>CollsInfo.pm</H2>
        <P>
The base class <TT>CollsInfo</TT>. An object of this class is created by the CGI program (usually via <TT>CioFactory</TT>) to maintain information about collections available for searching.  When a <TT>CollsInfo</TT> object is created it checks for a <TT>CollsInfo</TT> object cached on the <TT>DlpsSession</TT> object and reuses it if available or discards a cached <TT>CollsInfo</TT> object and rereads the database into a new <TT>CollsInfo</TT> object if the user's list of authorized collections has changed since the database was last accessed.  The <TT>CollsInfo</TT> object is passed a list of authorized collections from the environment.  If a collection row read from the database is not in the list of authorized collections, the row is not saved in the object. If an authorized collection does not appear in the database the <TT>CollsInfo</TT> object changes the authorized list by reference.  Finally, the <TT>CGI</TT> object's list of requested collections is similarly modified to reflect just those collections that are authorized and exist in the database.  The principal method of the <TT>CollsInfo</TT> class is <TT>GetCollKeyInfo</TT> which returns a single field's value for a given collection based on the name of the field.  </P>
        <P>Another function of the <TT>CollsInfo</TT> object is to instantiate and maintain per-collection objects (such as those defined by TextClass) and provide access to them.  This function is supported by the <TT>AddClassObjects</TT> method. </P>
      
      <H2>GroupsInfo.pm</H2>
        <P>
Encapsulates information from the groups table in the DLXS database. This information includes, for example, which collections belong to which groups.  The <TT>GroupsInfo</TT> object performs some validation on the groups it reads from the database by not storing any groups which consist entirely of unauthorized collections and removing collections from stored groups that are unauthorized.  Authorization is defined as belonging to the list of authorized collections passed in from the environment after the list has been processed by the <TT>CollsInfo</TT> object creation.</P>

      <H2>CioFactory.pm</H2>
        <P>
Contains methods to drive the creation of a <TT>CollsInfo</TT> object and <TT>GroupsInfo</TT> object from the <a href="../collmeta/dlxs-colldatabases.html">collection database</A>. The <TT>new</TT> method creates these objects and attaches them to the <TT>DlpsSession</TT> object.  The <TT>CioFactory</TT> is also responsible for creating an active database handle by connecting to the database.  It passes the handle to the <TT>CollsInfo</TT> and <TT>GroupsInfo</TT> objects it instantiates and saves the handle on the <TT>DlpsSession</TT> object for general use.  Another function of the <TT>CioFactory</TT> is to determine the cross-collection mode and store it on the <TT>DlpsSession</TT> object.  The cross-collection mode is based on whether one or more than one collection is being handled (either via a simple list of collections or as a group of collections).  </P>

    
    
    <H1>Session management</H1>
      <P>This group of modules and related files are used to implement session data that can persist for some defined period of time or indefinitely. Data that typically have a finite but short life span are the <TT>SearchHistory</TT> and the <TT>BookBag</TT> in TextClass. Arbitrary data accessible by key may be stored for convenience on the <TT>DlpsSession</TT> object. The storage can be persistent (available during the course of a session) or transient (not saved from CGI invocation to CGI invocation -- data can be treated as transient simply to have a convenient place to store it during the course of one CGI run).</P>
      <H2>DlpsSession.cfg</H2>
        <P>
The configuration file for the <TT>DlpsSession</TT> module.  An important global variable in this file is <TT>$gSessDatabaseSelector</TT> which configures the session backing store to CSV file or database.  Usernames and passwords are also configured here.</P>

      <H2>DlpsSession.pm</H2>
        <P>
The <TT>DlpsSession</TT> object. This object, which is a wrapper for the <TT>Apache::Session</TT> object, allows for Perl OO syntax access to the <TT>Apache::Session</TT> tied hash. Principal methods on this object are <TT>SetPersistentSessionItemByKey</TT> and <TT>GetPersistentSessionItemByKey</TT> which support saving and retrieving persistent data to the backing store.  The <TT>DlpsSession</TT> object contains an internal <TT>CioWrapper</TT> object which allows multiple <TT>CollsInfo</TT> and <TT>GroupsInfo</TT> object to be saved and retrieved for the support of multiple applications that typically each have their 
own collection metadata.  This mechanism is part of the cross-application functionality. </P>

      <H2>CioWrapper.pm</H2>
        <P>
<TT>CioWrapper</TT> is a container object encapsulated by the <TT>DlpsSession</TT> object used to aggregate several CollsInfo and GroupsInfo objects and provide access to them in a single package</P>

      <H2>CreateSessionTable.txt</H2>
        <P>This is a SQL script used to create a proper table in a SQL database to support <TT>DlpsSession</TT> sessions.</P>

    


    
	<H1>Application Class Modules</H1>
      <P>The modules in this section are for the support of the DLXS "Classes" (e.g., Text, Image, Bib) as Perl OO-classes so that they can be subclassed to modify behavior and instantiated as objects.  This architecture allows the CGI layer to be very thin and supports the creation of cross-class CGI application functionality such as searching and displaying results from more than one application class.</P>
      <H2>DLXSApp.pm</H2>
        <P>
The base Application class from which the principal DLXS Classes are derived. Its subclasses include <TT>BibApp</TT>, <TT>ImageApp</TT>, and <TT>FullTextApp</TT>, which in turn is subclassed into <TT>TextApp</TT> and <TT>FindaidApp</TT>.  <TT>DLXSApp</TT> provides a few methods which are common to all DLXS applications.  For more information about the
   full class hierarchy, see: <a href="./dlxs-object-hierarchy.html">DLXS Object Hierarchy</A>.</P>



    
    

<H1>(Document) Class Related Modules</H1>
   <P>The modules in this section have methods that represent the behavior specific to the types or classes of "objects" delivered through the DLXS Middleware (e.g., Text, Finding Aids, Bib). These are also OO classes so that they may be easily subclassed for the purpose of handling collection specific behavior.  Note: ImageClass does not currently participate in this class hierarchy. This hierarchy contains code for storing and retrieving collection data (including other objects) as well as code for searching and filtering. For more information about the
   full class hierarchy, see: <a href="./dlxs-object-hierarchy.html">DLXS Object Hierarchy</A>.</P>
   

<H2>DLXSClass.pm</H2>
<P>This is the superclass for all collections.  One subclass of this is <TT>FullTextClass</TT>, of which <TT>TextClass</TT> and <TT>FindaidClass</TT> are subclasses. <TT>BibClass</TT> is also a subclass of <TT>DLXSClass</TT>.</P>



<H2>PageViewer.pm</H2>
<P>The <TT>PageView</TT> object holds data from the PageView table in the <a href="../collmeta/dlxs-collmetadata-index.html">dlxs database</A>
(a table
containing metadata about all page images available for a particular SGML
file).</P>





    <H1>XPAT search and result modules</H1>
      <P>Modules in this section are concerned with constructing, organizing, submitting and retrieving queries using the XPAT search engine.</P>
      <H2>SearchSet.pm</H2>
<P>The <TT>SearchSet</TT> object encapsulates queries that will be sent in a
group to an XPat session. Each search is given a <I>label</I> by the CGI to
identify the kind of information that will be returned. When the searches in the search set
are sent to XPAT, this label is returned
along with the results for that search query. In this way, the <I>type</I> of results
can be known by the CGI, primarily so that decisions can be made about how to
filter the results. Search sets are grouped and identified by a <I>name</I>.
This is done so that, if needed, more than one group or set of searches can be
manipulated during the course of one CGI invocation.</P>


      <H2>XPat.pm</H2>
        <P><B>XPat.pm</B> contains code to handle create an <TT>XPat</TT> object. The
first thing this object does is open up of an XPAT session
for a particular TextClass instantiation. This entails forking off a process for
a collection that is local to the machine from which the request comes or
opening up a socket connection to a remote machine, if the collection data
resides on a different machine.</P>
<P>The middleware then uses this object to interact with an XPAT process. 
There is one <TT>XPat</TT> object per XPAT dd file used by a given collection. 
Through this object's methods the middleware can submit searches to XPAT and
receive results from it. The principal method is <TT>GetResultsFromQuery</TT>
which accepts a single query string in XPAT syntax and returns an XPAT result
encapsulated in an <TT>XPatResult</TT> object. 
Another commonly used method is <TT>GetSimpleResultsFromQuery</TT> which returns
the result in raw XPAT result syntax.</P>


      <H2>XPatResult.pm</H2>
        <P>An object of this class contains the results returned from one XPAT search. <TT>XPatResult</TT> is basically a container class which organizes an XPAT result by parsing the result into a record containing the raw SGML/XML data and the data byte offset.  The contents of the <TT>XPatResult</TT> object are retrieved by initializing an iterator (<TT>InitIterator</TT> method) and calling the <TT>GetNextResult</TT> method.</P>

      <H2>XPatResultSet.pm</H2>
        <P>A container object that maintains a set of <TT>XPatResult</TT> objects in a special form.  When an <TT>XPatResult</TT> object is added to an <TT>XPatResultSet</TT> object it loses its individual identity and becomes part of the set organized by byte offset.</P>

<P>The results are grouped by the same <B>name</B> identifying the <TT>SearchSet</TT>
that led to the results. Each result consists of three pieces
of information (which are acquired, parsed and separated by the <TT>XPat</TT>
object's <TT>AddResult</TT> method) plus another separate value. These four
pieces are: the index containing the result (in case there are multiple indexes
per collection), the byte offset of the result in the particular index's
data, the label given by the search, and the raw SGML returned by the XPAT query
(in the case of XPAT <B>pr</B> requests) or the number of matches (in the
case of simple requests), and a reference to the <TT>XPat</TT> object that was
used to get the results.</P>
<P>The <TT>GetNextResult</TT> method on <TT>XPatResultSet</TT> returns all XPAT results added to it in byte offset order.  There is also support for iteration over results by different sorting orders. </P>


      <H2>RemoteConnect.pm</H2>
        <P>Contains methods used by the middleware to connect via a socket to the <a href="../intro/dlxs-daemoninstall.html">dlxsd daemon</A> running on a remote host so that the remote host may run XPAT for the requesting machine. This class never needs subclassing.</P>

      <H2><A NAME="terminologymapper"></A>TerminologyMapper.pm</H2>
        <P>Encapsulates the mappings between labels and other terms for a given collection. These mappings are configured in a collection's <a href="../collmeta/dlxs-maps.html">map file</A> by the collection implementor.</P>

      <H2>QueryFactory.pm</H2>
        <P>A module that can, using a <TT>TerminologyMapper</TT> object and a <TT>CGI</TT> object, construct a basic XPAT query for simple, boolean and proximity searches.</P>

    
    
    <H1>Support modules</H1>
      <P>Modules in this section provide a variety of utility routines shared by all DLXS applicatons.</P>
      <H2>DevUtils.pm</H2>
        <P><I>Not object-oriented</I><BR />
A non-OO Perl module which groups together utility subroutines used by DLPS in development work. These allow, for example, the ability for different programming staff members to maintain individual working directories, apart from the directory holding the release version of the software.  Another example is support for collection authorization in an easily editable file instead of a database. </P>

      <H2>DlpsUtils.pm</H2>
        <P><I>Not object-oriented</I><BR />
A grouping of utility subroutines that are used throughout the DLXS middleware, including, for example, a routine to strip leading and trailing spaces from a string, finding the minimum or maximum of an array of values, error display, etc.</P>


      <H2>ObjectFactory.pm</H2>
        <P><TT>ObjectFactory</TT> is a factory class that manages the creation of various DLXS objects whose instantiation may require investigation of the collections in the current request to determine which subclass of the object to create.  If all collections in a request are configured to use a single subclass of a given Application, that subclass is instantiated. Otherwise the base application class (e.g. <TT>TextApp</TT>) is instantiated. <TT>ObjectFactory</TT> is used principally to instantiate <TT>TextApp</TT>, <TT>BibApp</TT> and <TT>ImageApp</TT> or subclasses thereof.  </P>


    
    
    <H1>Miscellaneous modules</H1>
      <H2><A NAME="procins"></A>ProcIns.pm</H2>
        <P>Contains methods to handle <a href="../ui/dlxs-templates.html#procins">Processing Instructions</A> found in HTML templates.</P>

      <H2><A NAME="applicationresult"></A>ApplicationResult.pm</H2>
        <P>This module provides a global array into which a given application class, such as TextClass, may insert the IDs of search results.  This array is managed for the purposes of sorting and efficient navigation over the list of results.  It alos provides mechanisms to allow more than one class to insert result IDs thereby laying the groundwork for integrated cross-class results display and navigation within a unitary user interface.  This object also has mechanisms to permit it to be saved on the DlpsSession object and so act as a result cache to improve performance when switching between views of the same results.</P>
      
      <H2>SearchHistory.pm</H2>
        <P>Keeps track of a user's searches during the course of a session. The list of previous searches can be recalled at any time. From the displayed list, clicking on any previous search will resubmit that search. The <TT>SearchHistory</TT> object is saved with the <TT>DlpsSession</TT> object.</P>

      <H2>WW.pm</H2>
        <P>An object of this class encapsulates data from a <a href="../class/text/tc-ww.html">wordwheel</A>, built in a separate process. </P>

      <H2>ww2.cfg</H2>
        <P>Configuration file for the WordWheel module.</P>

      <H2>roman_numeral.pm</H2>
        <P><I>Not object oriented.</I><BR />
 This module includes subroutines to convert strings representing Roman numerals to Arabic numerals and vice versa. Used mostly by <a href="../class/text/tc-pageviewer.html">pageviewer</A>. </P>

    
  </BODY>
 
</html>
