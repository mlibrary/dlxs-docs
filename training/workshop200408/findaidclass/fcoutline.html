<!DOCTYPE HTML PUBLIC "-//SoftQuad Software//DTD XMetaL 2.0::19990601::extensions to HTML 4.0//EN">
<HTML>
  <head>
	 <TITLE>Findaid Class Collection Implementation</TITLE>
	 <meta HTTP-EQUIV="Content-Type" content="text/html; charset=iso-8859-1">

	 <LINK REL="stylesheet" HREF="../styles.css" TYPE="TEXT/CSS">
    <style type="text/css">
<!--
body {
	margin-left: 10px;
	margin-top: 5px;
	margin-right: 10px;
	margin-bottom: 5px;
}
-->
</style></head>

  <BODY BGCOLOR="#ffffcc" CLASS="mainpalette">

   <P>&nbsp;
   </P>
   <H1><A NAME="Top"></A>Findaid Class Collection Implementation</H1>
	 <H2> <A HREF="../index.html">DLXS Workshop, August
		2004</A> </H2>
	 <P>Findaid Class Instructors: <b>Chris Powell, Alan Pagliere, with <a href="http://www.umich.edu/%7Ebhl/bhl/general/bhlstaff.htm" target="external">Greg Kinney</a>     </b>(of the <A HREF="http://www.umich.edu/~bhl/" TARGET="external">Bentley Historical
	       Library</A>) </P>
	 <P>This portion of the DLXS Workshop focuses on
		implementing a collection in the Findaid Class. It is organized as a hands-on
		lesson, with the entire process outlined in detail. All of the steps are
		included so that it can be repeated or used as a guide later. Links to the
		detailed Findaid Class documentation are included.</P>
	 <P>A printed copy of this document will be available at
		the workshop. </P><HR ALIGN="left" NOSHADE="NOSHADE" WIDTH="100%">
	 <P> <A
		HREF="#WorkshopDay2TuesdayAfternoon">Workshop Day 2 -- Tuesday Afternoon</A>
  </P>
	 <UL>
		<LI> <A HREF="#FindaidEncodingPractices">Findaid Class Encoding Practices and Processes</A>
		  <UL>
			 <LI> <A HREF="#ead2002DTDOverview">EAD 2002
				DTD Overview</A></LI>

			 <LI><A HREF="#PracticalEADEncodingIssues">Practical EAD Encoding Issues</A></LI>
			 <LI><A HREF="#DataPrep">Data Preparation</A></LI>

		  </UL></LI>
	 </UL>
	 <P> <A HREF="#WorkshopDay3WednesdayMorning">Workshop Day 3 -- Wednesday
		Morning</A> </P>
	 <UL>
		<LI> <A HREF="#FindaidClassIndexBuildingwithXPAT">Findaid Class Index Building
		  with XPAT</A>
		  <UL>
			 <LI> <A HREF="#SetupDirectoriesforXPATIndex">Set Up Directories and
				Files for XPAT Indexing</A> </LI>

			 <LI> <A HREF="#BuildtheXPATIndex">Build the XPAT Index</A> </LI>
		     <LI><A HREF="#FabRegions">Fabricated Regions in FindaidClass</A></LI>
		  </UL>
		</LI>
	 </UL>
	 <P> <A HREF="#WorkshopDay3WednesdayAfternoon">Workshop Day 3 -- Wednesday
		Afternoon</A> </P>
	 <UL>
		<LI> <A HREF="#FindaidClassCollectiontoWeb">Findaid Class Collection to Web</A>

		  <UL>
			 <LI> <A HREF="#ReviewtheCollectionDatabaseEntrywithCollMgr">Review
				the Collection Database Entry with CollMgr </A> </LI>
			 <LI> <A HREF="#ReviewtheGroupsDatabaseEntrywithCollMgr">Review the
				Groups Database Entry with CollMgr</A> </LI>
			 <LI> <A HREF="#MakeCollectionmaps">Make Collection Map</A> </LI>
			 <LI> <A HREF="#SetuptheCollectionsWebDirectory">Set Up the
				Collection's Web Directory</A> </LI>
			 <LI> <A HREF="#TryItOut">Try It Out</A> </LI>
		  </UL></LI>
		<LI><A HREF="#linking">Linking from Finding Aids Using the ID Resolver</A>


      </LI>
	 </UL>

	 <H3 CLASS="dayheader"> Workshop Day 2 -- Tuesday Afternoon<A
		NAME="WorkshopDay2TuesdayAfternoon"> </A></H3>
	 <H2 CLASS="partheader"><A NAME="FindaidEncodingPractices" ID="FindaidEncodingPractices"></A>Findaid Class Encoding Practices and Processes</H2>
	 <P ALIGN="right" CLASS="navlink"> <A
		HREF="#Top">go to table of contents</A> </P>
	 <P> In Findaid Class Encoding Practices and Processes we discuss the elements
		and attributes required for "out of the box" Findaid Class delivery, preparing the work environment and validating the data, and linking
		from finding aids using DAOs. Greg Kinney,  Associate
		Archivist, <A HREF="http://www.umich.edu/~bhl" TARGET="external">Bentley
		Historical Library</A>, will give a short presentation on the Bentley Library's
		encoding practices from the point of view of the Library's interpretation
		of the <A HREF="http://www.loc.gov/ead/" TARGET="external">EAD 2002 DTD</A> along
		with a description of the specific tools and workflow used to create
		the XML encoded finding aids files.</P>
	 <HR ALIGN="left" NOSHADE="NOSHADE" WIDTH="100%">
	 <H3 CLASS="sectionheader"><A NAME="ead2002DTDOverview"></A>EAD 2002 DTD
		Overview </H3>
	 <P>It is assumed that your Finding Aids have been encoded in the XML-based <A HREF="http://www.loc.gov/ead/" TARGET="external">EAD 2002
     DTD</A>. More specific DTD topics can be found at: <A HREF="http://www.loc.gov/ead/tglib/index.html" TARGET="external">http://www.loc.gov/ead/tglib/index.html</A>.</P>
	 <P>DLPS does not have any preferred methods or quick and easy tools for this stage of the process. Only you, looking at your
	    texts and your encoding practices, can do the intellectual work required
	    to encode your finding aids in XML using the EAD 2002 DTD. Greg Kinney
	    will discuss how the <A HREF="http://www.umich.edu/~bhl" TARGET="external">University of
	    Michigan's Bentley Historical Library</A> handles this process.</P>
	 <HR ALIGN="left" NOSHADE="NOSHADE" WIDTH="100%">
	 <H3 CLASS="sectionheader"> <A NAME="PracticalEADEncodingIssues"></A>Practical
	 EAD Encoding Issues </H3>
	<P>There are, however, two areas of practice that can have an effect on your online collection that are outside of hands-on encoding or conversion of word processed finding aids.  One is the use of IDs as attributes on elements.  I want to make it clear that we are NOT talking about the <SPAN CLASS="unixcommand">eadid</SPAN> here, but refer to IDs used to identify the element so that it can be referred to, or referenced from, somewhere else.  You no doubt all know that each ID within a document must be unique (and the DTD enforces this).  However, you may not have thought about the consequences of joining all your finding aids into one collection.  Your IDs will need to be unique across the entire collection.  One way to ensure this is to prefix ID values with the eadid for a given document.  At this time, there is no functionality in DLXS that requires you to have IDs on any elements, but you may have used them for your own internal purposes.  We have run into this ourselves and I just wanted to give everyone a heads-up, on the theory that our problems are fairly typical.</P>
	<P>Another issue that you might run into, especially if you are migrating finding
	   aids from SGML EAD 1.0 to XML EAD 2002, is that of handling special characters.
	   If you are authoring finding aids in multiple languages in XML using some
	   XML authoring tool, this is unlikely to be a problem for you -- you are
	   aware of the issues, UTF-8 is the default encoding for XML, you will have
	   no problems. You'll just want to make sure to index with the <A HREF="../unicode/unicode.html">UTF-8
	   enabled version of XPAT, as was discussed earlier</A>. If you have finding
	   aids with multiple languages and/or special characters, you've probably
	   thought this through already. However, if you have the occasionally e
	   acute (&eacute;)
	   in your SGML finding aid, you'll need to think about what you want to
	   do with these characters. A straight converstion from SGML to XML will
	   probably convert your character entities (for example, <SPAN CLASS="unixcommand">&amp;eacute;</SPAN>)
	   in your files to numeric entities (for example, <SPAN CLASS="unixcommand">&amp;#233;</SPAN>).
	   While this is valid, it will present a problem with regard to searching.
	   XPAT will treat this as a string of characters, and in order to search
	   for bless&eacute;d, you would need
	   to key in bless&amp;#233;d.
	   If all your special characters are ISO Latin 1, you can convert them to
	   their 8-bit equivalents and index as usual. If you have a mixture, UTF-8
	   is the way to go. Again, this is merely a heads up that will have no
	   bearing on the sample finding aids, which were chosen for their size and
	   linking behaviors, and which are sadly conventional in their use of character
	   entities (ampersand only, in fact).</P>
	 <HR ALIGN="left" NOSHADE="NOSHADE" WIDTH="100%"> <H3 CLASS="sectionheader"> <A NAME="DataPrep"></A>Data
	 Preparation </H3>
	 <P>For today, we are going to be working with some
		texts that are already in Findaid Class. We will
	    be building them into a collection we are going to call <b>workshopfa</b>.</P>
	 <P>This documentation will make use of the concept of
		the <SPAN CLASS="unixcommand">$<A HREF="../overview/dirstructure.html">DLXSROOT</A></SPAN>, which is the place at which
		your DLXS directory structure starts. We generally use <SPAN CLASS="unixcommand">/l1/</SPAN>,
		but for the workshop, we each have our own
		<SPAN CLASS="unixcommand">$DLXSROOT</SPAN> in the form of <SPAN CLASS="unixcommand">/l1/workshop/userX/dlxs/</SPAN>.
		To check your <SPAN CLASS="unixcommand">$DLXSROOT</SPAN>, type
		the following commands at the command prompt: </P>
	 <BLOCKQUOTE>	 <PRE CLASS="unixcommand">cd $DLXSROOT<BR>pwd</PRE>
  </BLOCKQUOTE>
<P>The <SPAN CLASS="unixcommand">prep</SPAN> directory under <SPAN CLASS="unixcommand">$DLXSROOT</SPAN> is
	    the space for you to take your encoded finding aids and &quot;package them
	    up&quot; for use with the DLXS middleware. Create your basic directory <SPAN CLASS="unixcommand">$DLXSROOT/prep/w/workshopfa</SPAN> and its <SPAN CLASS="unixcommand">data</SPAN> subdirectory with the following command: </P>
			 <BLOCKQUOTE>
				<PRE CLASS="unixcommand">mkdir -p $DLXSROOT/prep/w/workshopfa/data</PRE></BLOCKQUOTE>

	    <P>Move into the <SPAN CLASS="unixcommand">prep</SPAN> directory
	    with the following command:
  </P>
	 <BLOCKQUOTE> <PRE CLASS="unixcommand">cd $DLXSROOT/prep/w/workshopfa</PRE></BLOCKQUOTE>
	 <P>This will be your staging area for all the things
		you will be doing to your texts, and ultimately to your collection. At present,
		all it contains is the <SPAN CLASS="unixcommand">data</SPAN> subdirectory you created a moment ago. We will be
		populating it further over the course of the next two days. Unlike the contents
		of other collection-specific directories, everything in <SPAN CLASS="unixcommand">prep</SPAN> should be ultimately expendable in the
		production environment.</P>
	 <P>Copy the necessary files into your <SPAN CLASS="unixcommand">data</SPAN> directory
		with the following commands:</P>
	<BLOCKQUOTE> <PRE CLASS="unixcommand">cp $DLXSROOT/prep/s/samplefa/data/*.xml $DLXSROOT/prep/w/workshopfa/data/.</PRE></BLOCKQUOTE>

	<P>We'll also need a few files to get us started working.  They will need to be copied over as well, and also have paths adapted and collection identifiers changed.  Follow these commands:</P>

<BLOCKQUOTE> <PRE CLASS="unixcommand">cp $DLXSROOT/prep/s/samplefa/validateeach.csh $DLXSROOT/prep/w/workshopfa/.</PRE></BLOCKQUOTE>

<BLOCKQUOTE> <PRE CLASS="unixcommand">cp $DLXSROOT/prep/s/samplefa/samplefa.text.inp $DLXSROOT/prep/w/workshopfa/workshopfa.text.inp</PRE></BLOCKQUOTE>
<BLOCKQUOTE> <PRE CLASS="unixcommand">cp $DLXSROOT/prep/s/samplefa/samplefa.inp $DLXSROOT/prep/w/workshopfa/workshopfa.inp</PRE></BLOCKQUOTE>

<BLOCKQUOTE><PRE CLASS="unixcommand">mkdir -p $DLXSROOT/obj/w/workshopfa</PRE></BLOCKQUOTE>
<BLOCKQUOTE><PRE CLASS="unixcommand">mkdir -p $DLXSROOT/bin/w/workshopfa</PRE></BLOCKQUOTE>
<BLOCKQUOTE> <PRE CLASS="unixcommand">cp $DLXSROOT/bin/s/samplefa/preparedocs.pl $DLXSROOT/bin/w/workshopfa/.</PRE></BLOCKQUOTE>
<BLOCKQUOTE> <PRE CLASS="unixcommand">cp $DLXSROOT/bin/s/samplefa/validate.pl $DLXSROOT/bin/w/workshopfa/.</PRE></BLOCKQUOTE>

<P>Now you'll need to edit these files to ensure that the paths match your <SPAN CLASS="unixcommand">$DLXSROOT</SPAN> and that the collection name is <em>workshopfa</em> instead of <em>samplefa</em>.</P>

	 <P>With the ready-to-go ead2002 encoded finding aids files in the <SPAN CLASS="unixcommand">data</SPAN> directory,
	    we are ready to begin the preparation process. This will include:</P>
	 <OL>
	 <LI><A HREF="#DataPrepStep1">validating the  files individually</A> against
	    the EAD <em>2002</em> DTD</LI>
	 <LI><A HREF="#DataPrepStep2">concatenating the files into one larger XML file</A></LI>
	 <LI><A HREF="#DataPrepStep3">validating the concatenated file</A> against the
	    <em>dlxsead2002</em> DTD</LI>
  </OL>
	 <P>These steps are generally handled via the <SPAN CLASS="unixcommand">Makefile</SPAN> in <SPAN CLASS="unixcommand">$DLXSROOT/bin/s/samplefa</SPAN> but
	    during this workshop we will run through the steps &quot;manually.&quot; To
	    see the Makefile and how it is used, <A HREF="makefile.html">click here</A>.</P>
	 <HR WIDTH="75%">
	 <P><A NAME="DataPrepStep1"></A><strong>Step 1: Validating the
        files individually against the EAD 2002 DTD</strong></P>
	 <BLOCKQUOTE><PRE CLASS="unixcommand">cd $DLXSROOT/prep/w/workshopfa
./validateeach.csh</PRE></BLOCKQUOTE>
	 <P>What's happening: The script creates a temporary file without the public DOCTYPE declaration, runs <SPAN CLASS="unixcommand">onsgmls</SPAN> on each of the resulting XML files in the <SPAN CLASS="unixcommand">data</SPAN> subdirectory
	    to make sure they conform with the EAD 2002 DTD. If validation errors
	    occur, error files will be in the <SPAN CLASS="unixcommand">data</SPAN> subdirectory with the same name as the
	    finding aids file but with an extension of <SPAN CLASS="unixcommand">.err</SPAN>.
	    You fix the problems in the source XML files and re-run.</P>

	 <P>There are not likely to be any errors with the
		<b>workshopfa</b> data, but tell the instructor if there are. </P>
	 <HR WIDTH="75%">
	 <P><A NAME="DataPrepStep2" ID="DataPrepStep2"></A><strong>Step 2: Concatentating the
	    files into one larger XML file	</strong> <BLOCKQUOTE><PRE CLASS="unixcommand">cd $DLXSROOT/bin/w/workshopfa
./preparedocs.pl $DLXSROOT/prep/w/workshopfa/data $DLXSROOT/obj/w/workshopfa/workshopfa.xml $DLXSROOT/prep/w/workshopfa/logfile.txt</PRE></BLOCKQUOTE>
	 <P>The Perl script finds all XML files in the <SPAN CLASS="unixcommand">data</SPAN> subdirectory,
	    checks the encoding type, removes the XML and DOCTYPE declarations, and
	    then proceeds to add a prefix string to DAO links, removes empty <SPAN CLASS="unixcommand">persname</SPAN>, <SPAN CLASS="unixcommand">corpname</SPAN>,
	    and <SPAN CLASS="unixcommand">famname</SPAN> elements, and then concatenates
	    the files and wraps them with a collection (<SPAN CLASS="unixcommand">&lt;COLL&gt;</SPAN>) element.</P>
	 <P>If your collections need to be transformed in any way, or if you do not want the transformations to take place (the DAO changes, for example), edit this file to
	    effect the changes.</P>
	 <P>The output of this will be the one collection named xml file which is deposited
	    into the <SPAN CLASS="unixcommand">obj</SPAN> subdirectory. </P>
	 <HR WIDTH="75%">
	 <P><A NAME="DataPrepStep3" ID="DataPrepStep3"></A><strong>Step 3: Validating
     the concatenated file against the dlxsead2002 DTD</strong> </P>
	 <BLOCKQUOTE>
	 <PRE CLASS="unixcommand">onsgmls -s -f $DLXSROOT/prep/w/workshopfa/workshopfa.errors $DLXSROOT/misc/sgml/xml.dcl $DLXSROOT/prep/w/workshopfa/workshopfa.inp $DLXSROOT/obj/w/workshopfa/workshopfa.xml</PRE>  </BLOCKQUOTE>
  	 <P>The <em>dlxsead2002</em> DTD is exactly the same as the <em>EAD2002</em> DTD, but adds
  	    a wrapping element, <SPAN CLASS="unixcommand">&lt;COLL&gt;</SPAN>, to be able to combine more than one
  	    <SPAN CLASS="unixcommand">ead</SPAN> element, more than one finding aid, into one file. The larger file
  	    will be indexed with XPAT tomorrow. It is, of course, a good idea to
  	    validate the file now before going further.</P>
  	 <P>If there is an error, the file <SPAN CLASS="unixcommand">$DLXSROOT/prep/w/workshopfa/workshopfa.errors</SPAN> will be
  	    present and contain messages about the invalidities found. </P>
	 <BLOCKQUOTE>&nbsp;</BLOCKQUOTE>
	 	 <H3 CLASS="sectionheader"> <i>More Documentation</i> </H3>
	 	 <UL>
	 		<LI><A TARGET="external"
	 		  HREF="http://docs.dlxs.org/class/findaid/findaid-dtd.xml">The Findaid Class DTD</A></LI>
	 		<LI><A TARGET="external"
	 		  HREF="http://docs.dlxs.org/class/findaid/findaid-prep.xml">Preparation for Index Building (Finding Aids)</A></LI>
	 	 </UL>

	 <P> <A NAME="WorkshopDay3WednesdayMorning"> </A></P>
	 <H3 CLASS="dayheader">Workshop Day 3 -- Wednesday Morning</H3>
	 <H2 CLASS="partheader"><SPAN CLASS="dayheader"><A
		NAME="FindaidClassIndexBuildingwithXPAT"> </A></SPAN>Findaid Class Index Building with XPAT</H2>
	 <P ALIGN="right" CLASS="navlink">
		<A HREF="#Top">go to table of contents</A> </P>
	 <P>In this section the <b>workshopfa</b> XML will be indexed with the XPAT search engine, preparing it for use with the DLXS middleware.</P>
<HR ALIGN="left" NOSHADE="NOSHADE" WIDTH="100%">
	 <H3 CLASS="sectionheader"><A NAME="SetupDirectoriesforXPATIndex"> </A>Set
		Up Directories and Files for XPAT Indexing </H3>
	<P>Yesterday, we did what we needed to do with our
		materials "by hand" -- today, we will work with the materials packaged in the
		<b>samplefa</b> collection and adapt them for use with <b>workshopfa</b>. This
		should parallel what you'll be doing back at your institutions. First, we need
		to create the rest of the directories in the <b>workshopfa</b> environment with
		the following commands: </P>
		<BLOCKQUOTE>
				<PRE CLASS="unixcommand">mkdir -p $DLXSROOT/idx/w/workshopfa</PRE></BLOCKQUOTE>
<P>The <SPAN CLASS="unixcommand">bin</SPAN> directory we created yesterday holds any scripts or tools used for the collection specifically; <SPAN CLASS="unixcommand">obj</SPAN> (again, created yesterday) holds the "object" or XML file for the collection, and <SPAN CLASS="unixcommand">idx</SPAN> holds the XPAT indexes. Now we need to finish populating the directories.</P>
<BLOCKQUOTE>
		<PRE CLASS="unixcommand">cp $DLXSROOT/bin/s/samplefa/Makefile $DLXSROOT/bin/w/workshopfa/Makefile<BR>cp $DLXSROOT/prep/s/samplefa/samplefa.blank.dd $DLXSROOT/prep/w/workshopfa/workshopfa.blank.dd<BR>cp $DLXSROOT/prep/s/samplefa/samplefa.extra.srch $DLXSROOT/prep/w/workshopfa/workshopfa.extra.srch</PRE></BLOCKQUOTE>
	 <P CLASS="mainpalette">Each of these files need to be edited to reflect the
		new collection name and the paths to your particular directories. This will be
		true when you use these at your home institution as well, even if you use the
		same directory architecture as we do, because they will always need to reflect
		the unique name of each collection. Failure to change even one file can result in
		puzzling errors, because the scripts <i>are</i> working, just not necessarily
		in the directories you are looking at.</P>
	 <HR ALIGN="left" NOSHADE="NOSHADE" WIDTH="100%">
	 <H3 CLASS="sectionheader"> <A NAME="BuildtheXPATIndex"> </A>Build the XPAT
		Index </H3>
	 <P CLASS="mainpalette">Everything is now set up to build the XPAT index.
		The <SPAN CLASS="unixcommand">Makefile</SPAN> in the <SPAN CLASS="unixcommand">bin</SPAN> directory contains the commands necessary to build the
		index, and can be executed easily.</P>
	 <P CLASS="mainpalette">To create an index for use with the Findaid Class
		interface, you will need to index the words in the collection, then index
	    the XML (the structural metadata, if you will), and then finally "fabricate"
		structures based on a combination of elements (for example, defining
		who the
		"main author" of a finding aid is, without adding a <SPAN CLASS="unixcommand">&lt;mainauthor&gt;</SPAN> tag
		around the appropriate
		<SPAN CLASS="unixcommand">&lt;author&gt;</SPAN> in the <SPAN CLASS="unixcommand">eadheader</SPAN> element).
		The following commands can be used to make the index, alone or in combination.
		We will be using <SPAN CLASS="unixcommand">make singledd</SPAN>, <SPAN CLASS="unixcommand">make
		xml</SPAN>, and <SPAN CLASS="unixcommand">make post</SPAN>.</P>
	 <P CLASS="mainpalette"><em><strong>Aside</strong>: note that the Makefile also
	       contains targets for the commands you entered &quot;by hand&quot; above
        to validate and prepare the data. Read more about the <A HREF="makefile.html">Makefile</A>.</em></P>
	 <P CLASS="mainpalette"><b>make singledd</b> indexes words for texts that
		have been concatenated into on large file for a collection. This is the
		recommended process. </P>
		<P CLASS="mainpalette"><b>make sgml</b> indexes the SGML structure by
				reading the DTD. Validates as it indexes. Slower than mutlirgn
		   indexing (see below) for this reason. However, necessary for collections
		   that have nested elements of the same name. </P>
	    <P CLASS="mainpalette"><b>make xml</b> indexes the XML structure by
		reading the DTD. Validates as it indexes. Slower than multirgn indexing
	       (see below) for this reason. However, necessary for collections that
	       have nested elements of the same name. </P>
	    <P CLASS="mainpalette"><b>make multi</b> (multiregion structure indexing)
		indexes the XML structure and relies on a "tags file" (included in the sample
		collection) to know what XML elements and attributes to index. Rarely used
		with fully-encoded collections because of the nesting problem
		mentioned above. </P>
	 <P CLASS="mainpalette"><b>make mfsdd</b> (multi-file system indexing)
		indexes words and structure for each XML text listed in the data dictionary
		(dd) individually. Seems like a good idea -- no redundant copies of files! --
		but searching is slower than an index built of concatenated files. Also, if any
		one of the files referenced changes in any way, the entire index fails. We no
		longer use MFS indexes ourselves for this reason. </P>
	 <P CLASS="mainpalette"><b>make post</b> builds and indexes fabricated
		regions based on the XPAT queries stored in the workshopfa.extra.srch file.</P>
		<BLOCKQUOTE>
				<PRE CLASS="unixcommand">make singledd</PRE></BLOCKQUOTE>
			 <BLOCKQUOTE>
		<PRE>cp /l1/workshop/test02/dlxs/prep/w/workshopfa/workshopfa.blank.dd
	/l1/workshop/test02/dlxs/idx/w/workshopfa/workshopfa.dd
/l/local/xpat/bin/xpatbld -m 256m -D /l1/workshop/test02/dlxs/idx/w/workshopfa/workshopfa.dd
cp /l1/workshop/test02/dlxs/idx/w/workshopfa/workshopfa.dd
	/l1/workshop/test02/dlxs/prep/w/workshopfa/workshopfa.presgml.dd</PRE></BLOCKQUOTE>
<BLOCKQUOTE>
		<PRE CLASS="unixcommand">make xml</PRE></BLOCKQUOTE>
	 <BLOCKQUOTE>
		<PRE>cp /l1/workshop/test02/dlxs/prep/w/workshopfa/workshopfa.presgml.dd
	/l1/workshop/test02/dlxs/idx/w/workshopfa/workshopfa.dd
/l/local/xpat/bin/xmlrgn -D /l1/workshop/test02/dlxs/idx/w/workshopfa/workshopfa.dd
	/l1/workshop/test02/dlxs/misc/sgml/xml.dcl
	/l1/workshop/test02/dlxs/prep/w/workshopfa/workshopfa.inp
	/l1/workshop/test02/dlxs/obj/w/workshopfa/workshopfa.xml

cp /l1/workshop/test02/dlxs/idx/w/workshopfa/workshopfa.dd
	/l1/workshop/test02/dlxs/idx/w/workshopfa/workshopfa.prepost.dd</PRE></BLOCKQUOTE>
<BLOCKQUOTE>
		<PRE CLASS="unixcommand">make post</PRE></BLOCKQUOTE>
	 <BLOCKQUOTE>
		<PRE>cp /l1/workshop/test02/dlxs/prep/w/workshopfa/workshopfa.prepost.dd
	/l1/workshop/test02/dlxs/idx/w/workshopfa/workshopfa.dd
touch /l1/workshop/test02/dlxs/idx/w/workshopfa/workshopfa.init
/l/local/xpat/bin/xpat -q /l1/workshop/test02/dlxs/idx/w/workshopfa/workshopfa.dd
	< /l1/workshop/test02/dlxs/prep/w/workshopfa/workshopfa.extra.srch
	| /l1/workshop/test02/dlxs/bin/t/text/output.dd.frag.pl
	/l1/workshop/test02/dlxs/idx/w/workshopfa/
	> /l1/workshop/test02/dlxs/prep/w/workshopfa/workshopfa.extra.dd
/l1/workshop/test02/dlxs/bin/t/text/inc.extra.dd.pl
	/l1/workshop/test02/dlxs/prep/w/workshopfa/workshopfa.extra.dd
	/l1/workshop/test02/dlxs/idx/w/workshopfa/workshopfa.dd</PRE></BLOCKQUOTE>

<HR WIDTH="75%"><H3 CLASS="sectionheader"><A NAME="FabRegions" ID="FabRegions"> </A>Fabricated
		Regions in FindaidClass </H3>
		<P CLASS="sectionheader">The post step above leads us into a discussion of
		   the use of <strong>fabricated regions</strong> in FindaidClass. uses the
		   <SPAN CLASS="unixcommand">workshopfa.extra.srch</SPAN> file to add to the XPAT index. The Makefile
		   in the bin directory conta</P>

   <P>&quot;Fabricated&quot; is a term we use to describe what are essentially
      virtual regions in an XPat indexed text. See a <A HREF="../xpat/fabregions.html">basic
      description of what a fabricated region is and how they are created</A>. </P>
   <P>In Finding Aids, we use fabricated regions for certain uninteresting regions
      simply so that some code can be shared. For example, the fabricated region
      &quot;main&quot; is set to refer to <SPAN CLASS="unixcommand">&lt;ead&gt;</SPAN> in FindaidClass with:</P>
   <PRE CLASS="unixcommand">(region ead); {exportfile "/l1/idx/b/bhlead/main.rgn"}; export; ~sync "main";
</PRE>
   <P>whereas in TextClass
         &quot;main&quot; can refer to <SPAN CLASS="unixcommand">&lt;TEXT&gt;</SPAN>. Therfore, both FindaidClass
         and TextClass can share the Perl code, in a higher level subclass, that
         creates searches for &quot;main&quot;. </P>
   <P>More interesting and more specific to FindaidClass are some of those listed
      below, which are taken from the Bentley Historical Library's <SPAN CLASS="unixcommand">bhl.extra.srch</SPAN> file.
      (See the whole file <A HREF="bhl.extra.srch.txt">here</A>). You can see
      the creation of generic regions like &quot;c0xhead&quot;, everything from a <SPAN CLASS="unixcommand">&lt;c0x&gt;</SPAN>      open
      tag to the following closing <SPAN CLASS="unixcommand">&lt;/did&gt;</SPAN> tag. </P>
   <P>Another interesting fabricated region is the add. This used to be <SPAN CLASS="unixcommand">&lt;ADD&gt;</SPAN>      in
      the EAD 1.0 DTD, but now, is created based on the ead2002 DTD's <SPAN CLASS="unixcommand">&lt;descgrp&gt;</SPAN>      tag which contains a <SPAN CLASS="unixcommand">type</SPAN> attribute of <SPAN CLASS="unixcommand">add</SPAN>. </P>
   <P>One of the main reasons these are used is in the creation and display of
      the &quot;outline&quot; view. The <SPAN CLASS="unixcommand">FindaidClass.pm</SPAN>'s
      <SPAN CLASS="unixcommand">_initialize</SPAN> method sets a hash called
      &quot;tocheads&quot; whose elements correspond to most of these fabricated regions.
      In this way, the CGI can have a shorthand way of asking XPAT to return
      these regions, XPAT can have binary indexes ready to use for fast retrieval.</P>
   <HR WIDTH="75%">
   
  <PRE CLASS="unixcommand">(((region "&lt;c01".."&lt;/did>" + region "&lt;c02".."&lt;/did>" +
  region "&lt;c03".."&lt;/did>" +
    region "&lt;c04".."&lt;/did>" + region "&lt;c05".."&lt;/did>" + region "&lt;c06".."&lt;/did>" +
    region "&lt;c07".."&lt;/did>" + region "&lt;c08".."&lt;/did>" + region "&lt;c09".."&lt;/did>")
    not incl ("level=file" + "level=item")) incl "level="); {exportfile "/l1/idx/b/bhlead/c0xhead.rgn"};
    export; ~sync "c0xhead";
	
((region "&lt;origination".."&lt;/unittitle>") within ((region did within region
    archdesc) not within region dsc)); {exportfile "/l1/idx/b/bhlead/maintitle.rgn"};
    export; ~sync "maintitle";

(region "abstract" within ((region did within region archdesc) not within region "c01"));
    {exportfile "/l1/idx/b/bhlead/mainabstract.rgn"}; export; ~sync "mainabstract";
	
(region "eadid"); {exportfile "/l1/idx/b/bhlead/callnum.rgn"}; export; ~sync "callnum";

(region "dsc-T"); {exportfile "/l1/idx/b/bhlead/contentslist-t.rgn"}; export;
~sync "contentslist-t";

(region dsc); {exportfile "/l1/idx/b/bhlead/contentslist.rgn"}; export; ~sync "contentslist";

admininfot = (region "descgrp-T" incl (region "A-type" incl "admin")); 
	{exportfile "/l1/idx/b/bhlead/admininfo-t.rgn"};
	export; ~sync "admininfo-t";

(region "descgrp" incl *admininfot); {exportfile "/l1/idx/b/bhlead/admininfo.rgn"};
	export; ~sync "admininfo";

addt = (region "descgrp-T" incl (region "A-type" incl "add")); 
	{exportfile "/l1/idx/b/bhlead/add-t.rgn"};
	export; ~sync "add-t";

(region "descgrp" incl *addt); {exportfile "/l1/idx/b/bhlead/add.rgn"}; export;
	~sync "add";

region "controlaccess-T" ^ region "controlaccess"; 
	{exportfile "/l1/idx/b/bhlead/controlaccess-t.rgn"};
	export; ~sync "controlaccess-t";

(region "controlaccess"); {exportfile "/l1/idx/b/bhlead/controlaccess.rgn"};
	export; ~sync "controlaccess";

(region "subject" + region "occupation" + region "corpname" + region "famname" +
	region "name" + region "persname" + region "geogname"); 
	{exportfile "/l1/idx/b/bhlead/subjects.rgn"};
	export; ~sync "subjects";

(region "corpname" + region "famname" + region "name" + region "persname"); 
	{exportfile "/l1/idx/b/bhlead/names.rgn"};
	export; ~sync "names";

(region geogname); {exportfile "/l1/idx/b/bhlead/places.rgn"}; export; ~sync "places";
</PRE>

  <P>See a <A HREF="bhl.extra.srch.txt" TARGET="example">full listing of the <SPAN CLASS="unixcommand">extra.srch</SPAN> file
     of the Bentley Historical Library's finding aids</A>.</P>
  <HR WIDTH="75%">

	 <H3 CLASS="sectionheader"> <i>More Documentation</i></H3>
	 <UL>
		<LI><A TARGET="external" HREF="http://docs.dlxs.org/class/findaid/findaid-indexing.xml">Indexing
		  the Collection</A></LI><LI><A TARGET="external" HREF="http://docs.dlxs.org/class/findaid/findaid-fabrgn.xml">Fabricated regions in Findaid Class</A></LI>
  </UL>
	 <H3 CLASS="dayheader">Workshop Day 3 -- Wednesday Afternoon<A NAME="WorkshopDay3WednesdayAfternoon"></A></H3>
	 <H2 CLASS="partheader"><A
		NAME="FindaidClassCollectiontoWeb"> </A>Findaid Class Collection to Web</H2>
	 <P ALIGN="right" CLASS="navlink"> <A
		HREF="#Top">go to table of contents</A> </P>
	 <P>These are the final steps in deploying an Findaid Class
		collection online. Here the <b>Collection Manager</b> will be used to review
		the <b>Collection Database</b> entry for <b>workshopfa</b> . The <b>Collection
		Manager</b> will also be used to check the <b>Group Database</b>. Finally, we
		need to work with the collection map and the set up the collection's web
		directory.</P><HR ALIGN="left" NOSHADE="NOSHADE" WIDTH="100%">
	 <H3 CLASS="sectionheader"><A
		NAME="ReviewtheCollectionDatabaseEntrywithCollMgr"> </A>Review the Collection
		Database Entry with CollMgr </H3>
	 <P>Each collection has a record in the collection
		database that holds collection specific configurations for the middleware.
		CollMgr (Collection Manager) is a web based interface to the collection
		database that provides functionality for editing each collection's record.
		Collections can be checked-out for editing, checked-in for testing, and
		released to production.<b>A collection database record for workshopfa has
		already been created and we will edit it.</b> In general, a new collection
		needs to have a CollMgr record created from scratch before the middleware can
		be used. Take a look at the record to become familiar with it.</P>
	 <P>http://username.ws.umdl.umich.edu/cgi/c/collmgr/collmgr</P>

	 <P>Notice that it thinks it's the <b>samplefa</b>
		collection. Change references to s/samplefa to w/workshopfa . Let's change the name as
		well -- remove the reference to Sample DLXS Finding Aids Collection and change it to
		text:whatever you want to call it.</P>
	 <H3 CLASS="sectionheader"> <i>More Documentation</i> </H3>
	 <UL>
		<LI>
		  <A TARGET="external"
		  HREF="http://docs.dlxs.org/collmeta/dlxs-collmgr-fields.xml">Collection Manager
		  Field Descriptions</A></LI>
	 </UL><HR ALIGN="left" NOSHADE="NOSHADE" WIDTH="100%">
	 <H3 CLASS="sectionheader">
		<A NAME="ReviewtheGroupsDatabaseEntrywithCollMgr"></A>Review the Groups
		Database Entry with CollMgr </H3>
	 <P>Another function of CollMgr allows the grouping of
		collections for cross-collection searching. Any number of collection groups may
		be created for Findaid Class. Findaid Class supports a group with the groupid "all".
		It is not a requirement that all collections be in this group, though that's
		the basic idea. Groups are created and modified using CollMgr. <b>For this
		workshop, the group "all" record has already been edited to include the
		workshopfa collection.</b> Take a look at the record to become familiar with
		it.</P>
	 <P
	>http://username.ws.umdl.umich.edu/cgi/c/collmgr/collmgr</P>

	 <P>We won't be doing anything with groups; I'm sure you
		will in Image Class.</P><HR ALIGN="left" NOSHADE="NOSHADE" WIDTH="100%">
	 <H3 CLASS="sectionheader"><A NAME="MakeCollectionmaps"> </A>Make Collection
		Map </H3>
	 <P>Collection mapper files exist to identify the
		regions and operators used by the middleware when interacting with the search
		forms. Each collection will need one, but most collections can use a fairly
		standard map file, such as the one in the <b>samplefa</b> collection. The map
		files for all Findaid Class collections are stored in
		$DLXSROOT/misc/f/findaid/maps</P>
	 <P>Map files take language that is used in the forms
		and translates it into language for the cgi and for XPAT. For example, if you
		want your users to be able to search within names, you would need to add a
		mapping for how you want it to appear in the search interface (case is
		important, as is pluralization!), how the cgi variable would be set (usually
		all caps, and not stepping on an existing variable), and how XPAT will identify
		and retrieve this natively (in XPAT search language).</P>
	 <P>The first part of the map file is operator mapping, for
		the form, the cgi, and XPAT. The second part is for region mapping, as in the
		example above. </P>
	 <BLOCKQUOTE>
		<PRE CLASS="unixcommand">cd $DLXSROOT/misc/f/findaid/maps<BR>cp samplefa.map workshopfa.map</PRE></BLOCKQUOTE>

	 <P>&nbsp;</P>
	 <P>You might note that some of the fields that are defined in the map file
	    correspond to some of the <A HREF="#FabRegions">fabricated regions</A>.</P>
	 <H3 CLASS="sectionheader"><i>More Documentation</i> </H3>
	 <UL>
		<LI>
		  <A TARGET="external" HREF="http://docs.dlxs.org/collmeta/dlxs-maps.xml">DLXS
		  Map Files</A></LI> <LI><A TARGET="external" HREF="http://docs.dlxs.org/class/findaid/findaid-map.xml">Collection Map Files (Finding Aids)</A></LI>
	 </UL><HR ALIGN="left" NOSHADE="NOSHADE" WIDTH="100%">
	 <H3 CLASS="sectionheader"><A NAME="SetuptheCollectionsWebDirectory"></A>Set
		Up the Collection's Web Directory </H3>
	 <P>Each collection may have a <SPAN CLASS="unixcommand">web</SPAN> directory
	    with custom Cascading Style Sheets, interface templates, graphics, and
	    javascript. The default is for a collection to use the web templates
	    at<SPAN CLASS="unixcommand"> $DLXSROOT/web/f/findaid</SPAN>.
	    Of course, collection specific templates and other files can be placed
	    in a collection specific web directory, and it
	    is necessary if you have any customization at all. <em>DLXS Middleware uses	    <A HREF="../ui/userinterface.html#fallback">fallback</A> to
	    find HTML related templates, chunks, graphics, js and css files.</em></P>
	 <P>For
	    a minimal collection, you will want three files: <SPAN CLASS="unixcommand">index.html</SPAN>, <SPAN CLASS="unixcommand">home.tpl</SPAN>,
	    and <SPAN CLASS="unixcommand">FindaidClass-specific.css</SPAN>.
	    You'll also need a <SPAN CLASS="unixcommand">browse.tpl</SPAN> if you want
	    the collection to be browseable.</P>
	 <BLOCKQUOTE>
		<PRE CLASS="unixcommand">mkdir -p $DLXSROOT/web/w/workshopfa<BR>cp $DLXSROOT/web/s/samplefa/index.html $DLXSROOT/web/w/workshopfa/index.html<BR>cp $DLXSROOT/web/s/samplefa/home.tpl $DLXSROOT/web/w/workshopfa/home.tpl<BR>cp $DLXSROOT/web/s/samplefa/findaidclass-specific.css $DLXSROOT/web/w/workshopfa/findaidclass-specific.css</PRE>
</BLOCKQUOTE>

	 <P>As always, we'll need to change the collection name
		and paths. You might want to change the look radically, if your HTML skills are
		up to it.</P>

	 <H3 CLASS="sectionheader"> <i>More Documentation</i> </H3>
	 <UL>
		<LI><A HREF="http://docs.dlxs.org/class/findaid/fc-templates.xml"
		  TARGET="external">Findaid Class Templates</A></LI>
				<LI><A HREF="http://docs.dlxs.org/class/findaid/fc-graphics.xml"
		  TARGET="external">Findaid Class Graphics Files</A></LI>
		<LI><A
		  HREF="http://docs.dlxs.org/class/findaid/fc-findaidclass-css.xml"
		  TARGET="external">Full Text of FindaidClass.css</A></LI>
		  <LI><A
		  HREF="http://docs.dlxs.org/class/findaid/fc-findaid_results-css.xml"
		  TARGET="external">Full Text of Findaid_Results.css</A></LI>
		<LI><A HREF="http://docs.dlxs.org/class/findaid/fc-pis.xml"
		  TARGET="external">Findaid Class Processing Instructions</A></LI>
	 </UL><HR ALIGN="left" NOSHADE="NOSHADE" WIDTH="100%">
	 <H3 CLASS="sectionheader"><A NAME="TryItOut"> </A>Try It Out </H3>
	 <P CLASS="sectionheader">http://<em>username</em>.ws.umdl.umich.edu/cgi/f/findaid/findaid-idx</P>

	 <H3 CLASS="sectionheader"> <i>More Documentation</i> </H3>
	 <UL>
		<LI><A
		  HREF="http://docs.dlxs.org/class/findaid/findaid-index.xml"> <b>Guide to All Findaid Class
		  Documentation</b> </A></LI>
	 </UL>
<H2 CLASS="partheader">Linking from Finding Aids Using the ID Resolver<A
		NAME="linking"> </A></H2>
	 <P ALIGN="right" CLASS="navlink"> <A
		HREF="#Top">go to table of contents</A> </P>
	 <P>How do you do this?</P>
	 <FONT COLOR="#0000A0">ID Resolver Data Transformation and
	 Deployment</FONT></H1>

	 <P>The ID Resolver is a CGI&nbsp;that takes as input a unique
	 identifier and returns a URI. It is used, for example, by Harper's
	 Weekly to link the text pages in Text Class&nbsp;middleware to the image
	 pages in the Image Class middleware, and vice versa.

	 <H2>

	 <HR WIDTH="33%" ALIGN=left NOSHADE>

	 Master Data</H2>

	 <P>Resolver master is managed in a FileMaker Pro database named
	 "resolverdata.FP5" which is stored on the HTIWork server.
	 <P>In order to help keep track of changes to the idresolver database, duplicate the most recent <SPAN CLASS="unixcommand">idresolver</SPAN> folder. Rename the folder to include the current date <b>and your uniqname</b>. Copy the new folder to your local machine and work with it there. When done, be sure to move your copy of the FileMaker file back to the server replacing the folder with your name on it. Finally, remove your name from the folder.</P>
	 <P>Data should be provided in a tab delimited ascii text file that
	 has two fields.

	 <OL>
	    <LI>id</LI>

	    <LI>URI</LI>
	 </OL>

	 <P>Data additions can simply be imported into new records.


	 <P>Data updates should in most cases be done for an entire collection
	 at a time, rather than selectively for records within a collection.
	 In such a case, it is necessary to delete all of the existing records
	 for a collection so that duplicate data does not end up in the
	 system. FileMaker is not good about selectively replacing records.

	 <P>In some cases IDs have been altered to achieve uniqness within the system.
	    For example, some of the BHL IDs get prefixed with "dao-href-". There are
	    other situations like this. So, if updating data, be aware.</P>

	 <H2>

	 <HR WIDTH="33%" ALIGN=left NOSHADE>

	 Export from FileMaker</H2>

	 <UL>
	    <LI>Export from Filemaker the "ID" and "URI" fields as a TAB (tab
	    delimited ascii text) file (be sure to do a "Find All" first since
	    FileMaker only export records in the current found set).</LI>

	    <LI>Call the file "idresolver.tab"
	 </LI>
	 </UL>

	 <H2>

	 <HR WIDTH="33%" ALIGN=left NOSHADE>

	 Upload</H2>

	 <UL>
	    <LI>upload the "idresolver.tab" file to
	    the data prep server (sangria.umdl.umich.edu at  the time of writing)</LI>

	    <LI>put it in /l1/prep/i/idresolver</LI>
	 </UL>

	 <H2>

	 <HR WIDTH="33%" ALIGN=left NOSHADE>
	 Load Data into MySQL
	 </H2>
	 <P>
	 First, clean off any Macintosh line breaks (if the data was exported from Filemaker on the Macintosh).
	 </P>
	 <P CLASS="unixcommand">
	perl -pi -e 's,\x0d,\x0a,g' idresolver.tab
	 </P>

	 <P>use the <SPAN CLASS="unixcommand">mysqldump</SPAN> utilitiy to drop the
	    existing production table and to document the sql commands needed to rebuild
	    the table without data. You'll need to know the password for the <SPAN CLASS="unixcommand">dlxsadm</SPAN>	    MySQL account.</P>
	 <P CLASS="unixcommand">
	 mysqldump -u dlxsadm -p -h mysql.umdl.umich.edu --add-drop-table -d dlxs idresolver > /tmp/idresolver<
	 </P>
	 <P>
	 Recreate the table just dropped, except without data.
	 </P>
	 <P CLASS="unixcommand">
	mysql -u dlxsadm -p -h mysql.umdl.umich.edu dlxs < /tmp/idresolver
	 </P>
	 <P>
	 load the new data to the fresh table.</P>
	 <P CLASS="unixcommand">
	 mysql -u dlxsadm -p -h mysql.umdl.umich.edu dlxs
	 </P>
	 <P CLASS="unixcommand">load data local infile '/l1/prep/i/idresolver/idresolver.tab' into table idresolver;

	 </P>
	 <P>Use the following as a quick test...</P>
	 <P CLASS="unixcommand">select * from idresolver limit 1;
	 <BR>
	 <SPAN CLASS="unixcommand">select count(*) from idresolver;</SPAN>
	 </P>
	 <P>
	 Quit mysql</P>
	 <P CLASS="unixcommand">quit
	 </P>
	 <H2>

	 <HR WIDTH="33%" ALIGN=left NOSHADE>

	 Test</H2>

	 <P>Plug something like the following in to your web browser and you
	 should get something back. If you choose to test middleware on a development
	    machine that uses the id resolver, make sure that the middleware on that
	    machine is calling the resolver on the machine with the data, and not
	    the resolver on the production server.

	 <UL>
	    <LI><A HREF="http://clamato.umdl.umich.edu/cgi/i/idresolver/idresolver?id=dao-bhl-bl000684">http://clamato.hti.umich.edu/cgi/i/idresolver/idresolver?id=dao-bhl-bl000684</A></LI>

	 <LI>which should yield...<BR>
	 <CODE><b>&lt;ITEM MTIME="20030728142225"&gt;&lt;ID&gt;dao-bhl-bl000684 &lt;/ID&gt;&lt;URI&gt;http://images.umdl.umich.edu/cgi/i/image/image-idx?&q1=bl000684&rgn1=bhl_href&type=boolean&med=1&view=thumbnail&c=bhl &lt;/URI&gt;&lt;/ITEM&gt;</b></CODE>

	 </LI>
	 </UL>
</BODY>
</HTML>
